<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Squiggly.io</title>

	<style>
		div {
			text-align: center;
			margin-top: 5%;
			font-family: Verdana;
		}
	</style>

	<style>
		canvas {
			padding: 0;
			margin: auto;
			margin-top: 5%;
			display: block;
		}
	</style>

	<style>
		img {
			display: block;
			margin-top: 5%;
			margin-left: auto;
			margin-right: auto;
		}	

		button {
			font-family: Verdana;
			margin-left: auto;
			margin-right: auto;
		}
	</style>

</head>
<body>

	<div id="timeDiv">
		Score: <span id="time">0</span>
	</div>

	<div id="gameOverDiv">
		Press any arrow key to start
	</div>

	<canvas id="myCanvas" width ="500" height="500" style="border: 5px solid black">
	</canvas>	

	<button id="slowerB">Slower</button>

	<script>
		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");
		var dotSize = 40;
		var x = canvas.width/2 - dotSize/2;
		var y = canvas.height/2 - dotSize/2;
		var up = false;
		var down = false;
		var left = false;
		var right = false;
		var speed = 10;
		var refreshRate = 100;

		var matrix = new Array(canvas.height);
		for (var i = 0; i < canvas.height; i++) {
			matrix[i] = new Array(canvas.width);
		}
		for (var i = 0; i < canvas.height; i++) {
			for (var j = 0; j < canvas.width; j++) {
				matrix[i][j] = 0;
			}
		}

		var slowerB = document.getElementById('slowerB');
		slowerB.onclick = changeSpeed;

		document.addEventListener("keydown", keyDownHandler, false);

		function changeSpeed() {
			refreshRate *= 2;
		}

		function keyDownHandler(e) {
			if (e.key == "ArrowUp") {
				up = true;
				down = false;
				left = false;
				right = false;
			}
			else if (e.key == "ArrowDown") {
				up = false;
				down = true;
				left = false;
				right = false;
			}
			else if (e.key == "ArrowLeft") {
				up = false;
				down = false;
				left = true;
				right = false;
			}
			else if (e.key == "ArrowRight") {
				up = false;
				down = false;
				left = false;
				right = true;
			}
		}

		function drawPoint() {
			ctx.beginPath();
			ctx.rect(x, y, dotSize, dotSize);
			for (var i = 0; i < dotSize; i++) {
				for (var j = 0; j < dotSize; j++) {
					matrix[y+i][x+j] = 1;
				}
			}
			ctx.fillStyle = "black";
			ctx.fill();		
			ctx.closePath();
		}
		
		function gameOver() {
			up = false;
			down = false;
			left = false;
			right = false;
			document.getElementById("gameOverDiv").innerHTML = "GAME OVER";
			clearInterval(interval);
		}

		function draw() {
			if (up) {
				y -= speed;
				if (y < 0) {
					gameOver();
				}
				else if (y >= speed) {
					for (var i = 0; i < dotSize; i++) {
						if (matrix[y][x+i] == 1) {
							gameOver();
							break;
						}
					}
				}
			}

			else if (down) {
				y += speed;
				if (y + dotSize - speed > canvas.height) {
					gameOver();
				}
				else {
					for (var i = 0; i < dotSize; i++) {
						if (matrix[y+dotSize-speed][x+i] == 1) {
							gameOver();
							break;
						}
					}
				}
			}

			else if (left) {
				x -= speed;
				if (x < 0) {
					gameOver();
				}
				else {
					for (var i = 0; i < dotSize; i++) {
						if (matrix[y+i][x] == 1) {
							gameOver();
							break;
						}
					}
				}
			}

			else if (right) {
				x += speed;
				if (x + dotSize - speed > canvas.width) {
					gameOver();
				}
				else {
					for (var i = 0; i < dotSize; i++) {
						if (matrix[y+i][x+dotSize-speed] == 1) {
							gameOver();
							break;
						}
					}
				}
			}
			drawPoint();
		}

		var timeElapsed = 0;

		function timer() {
			if (up || down || left || right) {
				timeElapsed += Math.round(100/refreshRate);
				document.getElementById("time").innerHTML = timeElapsed;
				document.getElementById("gameOverDiv").innerHTML = "<br>";
			}
		}

		drawPoint();	
		// var setRefreshRate = function() {
		// 	clearInterval(interval);
		// 	interval = setInterval(function() {draw(), timer()}, refreshRate);
		// }
		// var interval = setInterval(function() {draw(), timer()}, refreshRate);
		var interval = setInterval(eachIteration, refreshRate);
			function eachIteration() {
				draw();
				timer();
				clearInterval(interval);
				interval = setInterval(eachIteration, refreshRate);
			}

	</script>

</body>
</html>